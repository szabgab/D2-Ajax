<head>
    <script src="../public/javascripts/angular.min.js"></script>
    <link rel="stylesheet" href="../public/themes/blue/style.css" type="text/css" media="print, projection, screen" />
</head>

<script>
angular.module("DemoApp", [])
    .controller("DemoController", function($scope, $http) {
        $scope.add_item = function() {
            $http.post('http://127.0.0.1:5000/api/v2/item', {text: $scope.text} ).then(
                function(response) {
                    console.log(response);
                    $scope.result = response.data;
                    console.log($scope.items);
                    $scope.get_items();
                },
                function(response) {
                    console.log("error");
                }
            );
        }
        $scope.get_items = function() {
            $http.get('http://127.0.0.1:5000/api/v2/items').then(
                function(response) {
                    //console.log(response);
                    $scope.data = response.data;
                    console.log($scope.data);
                },
                function(response) {
                    console.log("error");
                }
            );
        }
        $scope.delete = function() {
            var id = this.i._id['$oid'];
            console.log(id);

            $http.delete('http://127.0.0.1:5000/api/v2/item/' + id).then(
                function(response) {
                    console.log(response);
                    $scope.get_items();
                },
                function(response) {
                    console.log("error");
                }
            );
        }
        $scope.get_items();
    }
);

</script>
<div ng-app="DemoApp" ng-controller="DemoController">
    <input ng-model="text"><button ng-click="add_item()">Add</button>
    {{items}}

    <table id="items-table" class="tablesorter">
        <thead>
        <tr><th>Item</th><th>Date</th><th>X</th></tr>
        </thead>
        <tbody>
        <tr ng-repeat="i in data.items track by $index"><td>{{ i.text }}</td><td class="date" sort="{{ i.date }}">{{ i.date }}</td><td><button class="delete" ng-click="delete()">x</a></td></tr>
        </tbody>
    </table>
</div>
